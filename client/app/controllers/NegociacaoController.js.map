{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DataInvalidaException","DateConverter","getNegociacaoDao","Bind","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_negociacoesView","update","_mensagem","_mensagemView","_service","_init","event","preventDefault","negociacao","_criaNegociacao","dao","adiciona","texto","_limpaFormulario","err","message","then","catch","console","log","stack","value","focus","paraData","parseInt","parseFloat","apaga","apagaTodos","esvazia","importarNegociacoes","negociacoes","obtemNegociacoesDoPeriodo","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals","forEach"],"mappings":";;;;;;AAASA,uB,kBAAAA,W;AAAaC,6B,kBAAAA,iB;AAAmBC,sB,kBAAAA,U;;AAChCC,2B,cAAAA,e;AAAiBC,wB,cAAAA,Y;AAAcC,oB,cAAAA,Q;AAAUC,iC,cAAAA,qB;AAAuBC,yB,cAAAA,a;;AAChEC,4B,gBAAAA,gB;AAAkBC,gB,gBAAAA,I;;;AAEpB,kBAAMC,oBAAN,CAA2B;;AAE9BC,8BAAc;AACV;AACA;AACA,0BAAMC,IAAIC,SAASC,aAAT,CAAuBC,IAAvB,CAA4BF,QAA5B,CAAV;;AAEA,yBAAKG,UAAL,GAAwBJ,EAAE,OAAF,CAAxB;AACA,yBAAKK,gBAAL,GAAwBL,EAAE,aAAF,CAAxB;AACA,yBAAKM,WAAL,GAAwBN,EAAE,QAAF,CAAxB;;AAEA,yBAAKO,YAAL,GAAoB,IAAIV,IAAJ,CAChB,IAAIT,WAAJ,EADgB,EAEhB,IAAIG,eAAJ,CAAoB,cAApB,CAFgB,EAGhB,UAHgB,EAGJ,SAHI,CAApB;;AAMA,yBAAKiB,gBAAL,GAAwB,IAAIjB,eAAJ,CAAoB,cAApB,CAAxB;AACA,yBAAKiB,gBAAL,CAAsBC,MAAtB,CAA6B,KAAKF,YAAlC;;AAEA,yBAAKG,SAAL,GAAiB,IAAIb,IAAJ,CACb,IAAIJ,QAAJ,EADa,EAEb,IAAID,YAAJ,CAAiB,eAAjB,CAFa,EAGb,OAHa,CAAjB;;AAMA,yBAAKmB,aAAL,GAAqB,IAAInB,YAAJ,CAAiB,eAAjB,CAArB;AACA,yBAAKmB,aAAL,CAAmBF,MAAnB,CAA0B,KAAKC,SAA/B;;AAEA,yBAAKE,QAAL,GAAgB,IAAIvB,iBAAJ,EAAhB;;AAEA,yBAAKwB,KAAL;AACH;;AAED,sBAAMA,KAAN,GAAa;AACT,wBAAI;AACAC,8BAAMC,cAAN;AACA,8BAAMC,aAAa,KAAKC,eAAL,EAAnB;AACA,8BAAMC,MAAM,MAAMtB,kBAAlB;AACA,8BAAMsB,IAAIC,QAAJ,CAAaH,UAAb,CAAN;AACA,6BAAKT,YAAL,CAAkBY,QAAlB,CAA2BH,UAA3B;AACA,6BAAKN,SAAL,CAAeU,KAAf,GAAuB,mCAAvB;AACA,6BAAKC,gBAAL;AACC,qBARL,CAQM,OAAMC,GAAN,EAAW;AACb,6BAAKZ,SAAL,CAAeU,KAAf,GAAuBE,IAAIC,OAA3B;AACH;AACJ;;AAEDJ,yBAASL,KAAT,EAAgB;AACZ,wBAAI;AACAA,8BAAMC,cAAN;AACA,8BAAMC,aAAa,KAAKC,eAAL,EAAnB;AACArB,2CACK4B,IADL,CACUN,OAAOA,IAAIC,QAAJ,CAAaH,UAAb,CADjB,EAEKQ,IAFL,CAEU,MAAM;AACR;AACA,iCAAKjB,YAAL,CAAkBY,QAAlB,CAA2BH,UAA3B;AACA,iCAAKN,SAAL,CAAeU,KAAf,GAAuB,mCAAvB;AACA,iCAAKC,gBAAL;AACH,yBAPL,EAQKI,KARL,CAQWH,OAAO,KAAKZ,SAAL,CAAeU,KAAf,GAAuBE,GARzC;AASH,qBAZD,CAYE,OAAOA,GAAP,EAAY;AACVI,gCAAQC,GAAR,CAAYL,GAAZ;AACAI,gCAAQC,GAAR,CAAYL,IAAIM,KAAhB;;AAEA,4BAAGN,eAAe5B,qBAAlB,EAAyC;AACrC,iCAAKgB,SAAL,CAAeU,KAAf,GAAuBE,IAAIC,OAA3B;AACH,yBAFD,MAEO;AACH;AACA,iCAAKb,SAAL,CAAeU,KAAf,GAAuB,gEAAvB;AACH;AACJ;AACJ;;AAEDC,mCAAmB;AACf,yBAAKjB,UAAL,CAAgByB,KAAhB,GAAwB,EAAxB;AACA,yBAAKxB,gBAAL,CAAsBwB,KAAtB,GAA8B,CAA9B;AACA,yBAAKvB,WAAL,CAAiBuB,KAAjB,GAAyB,GAAzB;AACA,yBAAKzB,UAAL,CAAgB0B,KAAhB;AACH;;AAEDb,kCAAkB;AACd,2BAAO,IAAI3B,UAAJ,CACHK,cAAcoC,QAAd,CAAuB,KAAK3B,UAAL,CAAgByB,KAAvC,CADG,EAEHG,SAAS,KAAK3B,gBAAL,CAAsBwB,KAA/B,CAFG,EAGHI,WAAW,KAAK3B,WAAL,CAAiBuB,KAA5B,CAHG,CAAP;AAKH;;AAED,sBAAMK,KAAN,GAAc;AACV,wBAAI;AACA,8BAAMhB,MAAM,MAAMtB,kBAAlB;AACA,8BAAMsB,IAAIiB,UAAJ,EAAN;AACA,6BAAK5B,YAAL,CAAkB6B,OAAlB;AACA,6BAAK1B,SAAL,CAAeU,KAAf,GAAuB,kCAAvB;AAEC,qBANL,CAMM,OAAME,GAAN,EAAW;AACT,6BAAKZ,SAAL,CAAeU,KAAf,GAAuBE,IAAIC,OAA3B;AACH;AACR;;AAED,sBAAMc,mBAAN,GAA2B;AACvB,wBAAI;AACA,8BAAMC,cAAc,MAAM,KAAK1B,QAAL,CAAc2B,yBAAd,EAA1B;AACAb,gCAAQC,GAAR,CAAYW,WAAZ;AACAA,oCAAYE,MAAZ,CAAmBC,kBACf,CAAC,KAAKlC,YAAL,CAAkBmC,SAAlB,GAA8BC,IAA9B,CAAmCC,uBAChCH,eAAeI,MAAf,CAAsBD,mBAAtB,CADH,CADL,EAGSE,OAHT,CAGiB9B,cAAc,KAAKT,YAAL,CAAkBY,QAAlB,CAA2BH,UAA3B,CAH/B;AAIA,6BAAKN,SAAL,CAAeU,KAAf,GAAuB,+CAAvB;AACH,qBARD,CAQE,OAAME,GAAN,EAAW;AACL,6BAAKZ,SAAL,CAAeU,KAAf,GAAuBE,IAAIC,OAA3B;AACP;AACJ;AAjH6B","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao} from '../domain/index.js';\nimport { NegociacoesView, MensagemView, Mensagem, DataInvalidaException, DateConverter } from '../ui/index.js';\nimport { getNegociacaoDao, Bind} from '../util/index.js';\n\nexport class NegociacaoController {\n\n    constructor() {\n        // Criação de variável passando uma função. Foi necessário fazer o bind, \n        //pois document.querySelector estava fora de contexto.\n        const $ = document.querySelector.bind(document);\n\n        this._inputData       = $('#data');\n        this._inputQuantidade = $('#quantidade');\n        this._inputValor      = $('#valor');\n\n        this._negociacoes = new Bind(\n            new Negociacoes(),\n            new NegociacoesView('#negociacoes'),\n            'adiciona', 'esvazia'\n        );\n        \n        this._negociacoesView = new NegociacoesView('#negociacoes');\n        this._negociacoesView.update(this._negociacoes);\n        \n        this._mensagem = new Bind(\n            new Mensagem(),\n            new MensagemView('#mensagemView'),\n            'texto'\n        );\n\n        this._mensagemView = new MensagemView('#mensagemView');\n        this._mensagemView.update(this._mensagem);\n\n        this._service = new NegociacaoService();\n\n        this._init();\n    }\n\n    async _init(){\n        try {\n            event.preventDefault();\n            const negociacao = this._criaNegociacao();\n            const dao = await getNegociacaoDao();\n            await dao.adiciona(negociacao);\n            this._negociacoes.adiciona(negociacao);\n            this._mensagem.texto = 'Negociação adicionada com sucesso';\n            this._limpaFormulario();\n            } catch(err) {\n            this._mensagem.texto = err.message;\n        }\n    }\n\n    adiciona(event) {\n        try {\n            event.preventDefault();\n            const negociacao = this._criaNegociacao();\n            getNegociacaoDao()\n                .then(dao => dao.adiciona(negociacao))\n                .then(() => {\n                    // só tentará incluir na tabela se conseguiu antes incluir no banco\n                    this._negociacoes.adiciona(negociacao);\n                    this._mensagem.texto = 'Negociação adicionada com sucesso';\n                    this._limpaFormulario();\n                })\n                .catch(err => this._mensagem.texto = err);\n        } catch (err) {\n            console.log(err);\n            console.log(err.stack);\n\n            if(err instanceof DataInvalidaException) {\n                this._mensagem.texto = err.message;\n            } else {\n                // mensagem genérica para qualquer problema que possa acontecer\n                this._mensagem.texto = 'Um erro não esperado aconteceu. Entre em contato com o suporte';\n            }\n        }\n    }\n\n    _limpaFormulario() {\n        this._inputData.value = '';\n        this._inputQuantidade.value = 1;\n        this._inputValor.value = 0.0;\n        this._inputData.focus();\n    }\n\n    _criaNegociacao() {\n        return new Negociacao(\n            DateConverter.paraData(this._inputData.value),\n            parseInt(this._inputQuantidade.value),\n            parseFloat(this._inputValor.value)\n        );\n    }\n\n    async apaga() {\n        try {\n            const dao = await getNegociacaoDao();\n            await dao.apagaTodos();\n            this._negociacoes.esvazia();\n            this._mensagem.texto = 'Negociações apagadas com sucesso'\n            ;\n            } catch(err) {\n                this._mensagem.texto = err.message;\n            }\n    }\n\n    async importarNegociacoes(){\n        try {\n            const negociacoes = await this._service.obtemNegociacoesDoPeriodo();\n            console.log(negociacoes);\n            negociacoes.filter(novaNegociacao =>\n                !this._negociacoes.paraArray().some(negociacaoExistente =>\n                    novaNegociacao.equals(negociacaoExistente)))\n                    .forEach(negociacao => this._negociacoes.adiciona(negociacao));\n            this._mensagem.texto = 'Negociações do período importadas com sucesso';\n        } catch(err) {\n                this._mensagem.texto = err.message;\n        }\n    }\n}"]}