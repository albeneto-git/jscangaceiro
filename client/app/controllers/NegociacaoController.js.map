{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DataInvalidaException","DateConverter","getNegociacaoDao","Bind","getExceptionMessage","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_negociacoesView","update","_mensagem","_mensagemView","_service","_init","negociacao","_criaNegociacao","dao","adiciona","texto","_limpaFormulario","err","event","preventDefault","then","catch","value","focus","paraData","parseInt","parseFloat","apaga","apagaTodas","esvazia","importarNegociacoes","negociacoes","obtemNegociacoesDoPeriodo","console","log","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals","forEach"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao} from '../domain/index.js';\nimport { NegociacoesView, MensagemView, Mensagem, DataInvalidaException, DateConverter } from '../ui/index.js';\nimport { getNegociacaoDao, Bind, getExceptionMessage} from '../util/index.js';\n\nexport class NegociacaoController {\n\n    constructor() {\n        // Criação de variável passando uma função. Foi necessário fazer o bind, \n        //pois document.querySelector estava fora de contexto.\n        const $ = document.querySelector.bind(document);\n\n        this._inputData       = $('#data');\n        this._inputQuantidade = $('#quantidade');\n        this._inputValor      = $('#valor');\n\n        this._negociacoes = new Bind(\n            new Negociacoes(),\n            new NegociacoesView('#negociacoes'),\n            'adiciona', 'esvazia'\n        );\n        \n        this._negociacoesView = new NegociacoesView('#negociacoes');\n        this._negociacoesView.update(this._negociacoes);\n        \n        this._mensagem = new Bind(\n            new Mensagem(),\n            new MensagemView('#mensagemView'),\n            'texto'\n        );\n\n        this._mensagemView = new MensagemView('#mensagemView');\n        this._mensagemView.update(this._mensagem);\n\n        this._service = new NegociacaoService();\n\n        this._init();\n    }\n\n    async _init(){\n        try {\n            const negociacao = this._criaNegociacao();\n            const dao = await getNegociacaoDao();\n            await dao.adiciona(negociacao);\n            this._negociacoes.adiciona(negociacao);\n            this._mensagem.texto = 'Negociação adicionada com sucesso';\n            this._limpaFormulario();\n            } catch(err) {\n                this._mensagem.texto = getExceptionMessage(err);\n        }\n    }\n\n    adiciona(event) {\n        try {\n            event.preventDefault();\n            const negociacao = this._criaNegociacao();\n            getNegociacaoDao()\n                .then(dao => dao.adiciona(negociacao))\n                .then(() => {\n                    // só tentará incluir na tabela se conseguiu antes incluir no banco\n                    this._negociacoes.adiciona(negociacao);\n                    this._mensagem.texto = 'Negociação adicionada com sucesso';\n                    this._limpaFormulario();\n                })\n                .catch(err => this._mensagem.texto = err);\n        } catch (err) {\n            this._mensagem.texto = getExceptionMessage(err);\n        }\n    }\n\n    _limpaFormulario() {\n        this._inputData.value = '';\n        this._inputQuantidade.value = 1;\n        this._inputValor.value = 0.0;\n        this._inputData.focus();\n    }\n\n    _criaNegociacao() {\n        return new Negociacao(\n            DateConverter.paraData(this._inputData.value),\n            parseInt(this._inputQuantidade.value),\n            parseFloat(this._inputValor.value)\n        );\n    }\n\n    async apaga() {\n        try {\n            const dao = await getNegociacaoDao();\n            await dao.apagaTodas();\n            this._negociacoes.esvazia();\n            this._mensagem.texto = 'Negociações apagadas com sucesso';\n            } catch(err) {\n                this._mensagem.texto = getExceptionMessage(err);\n            }\n    }\n\n    async importarNegociacoes(){\n        try {\n            const negociacoes = await this._service.obtemNegociacoesDoPeriodo();\n            console.log(negociacoes);\n            negociacoes.filter(novaNegociacao =>\n                !this._negociacoes.paraArray().some(negociacaoExistente =>\n                    novaNegociacao.equals(negociacaoExistente)))\n                    .forEach(negociacao => this._negociacoes.adiciona(negociacao));\n            this._mensagem.texto = 'Negociações do período importadas com sucesso';\n        } catch(err) {\n            this._mensagem.texto = getExceptionMessage(err);\n        }\n    }\n}"]}